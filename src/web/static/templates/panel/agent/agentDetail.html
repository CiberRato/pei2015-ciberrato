<div class="content-block" role="main" ng-controller="AgentDetailController">
    <!-- Grid row -->
    <div class="row">

        <!-- Data block -->
        <article class="span12 data-block">
            <div class="data-container">
                <section class="tab-content">

                    <!-- Tab #static -->
                    <div class="tab-pane active" id="static">
                        <h2><span id="agent_name">{{vm.agent.agent_name}}</span> ({{vm.agent.team_name}}) </h2>
                        <div ng-if="vm.agent.code_valid == false && vm.agent.validation_result.length > 0 && vm.agent.validation_result != 'submitted' && vm.files.length != 0" class="alert alert-error">
                            <strong>Code not valid!</strong><br/> {{vm.agent.validation_result}}<br/><br/>
                            <button class="btn btn-flat btn-warning" ng-click="vm.validateCode()">Validate Code!</button>
                        </div>
                        <div ng-if="vm.agent.code_valid == false && vm.agent.validation_result.length > 0 && vm.agent.validation_result == 'submitted'" class="alert alert-info">
                            <strong>Submitted for validation!</strong> Please wait for a while...
                        </div>
                        <div ng-if="vm.agent.code_valid == true" class="alert alert-success">
                            <strong>Code valid!</strong> {{vm.agent.validation_result}}
                        </div>
                        <div ng-if="vm.agent.code_valid == false && vm.agent.validation_result.length == 0 && vm.files.length != 0" class="alert alert-inverse">
                            <strong>Please run a code validation!</strong>&nbsp;&nbsp;
                            <button class="btn btn-flat btn-warning" ng-click="vm.validateCode()">Validate Code!</button>
                        </div>
                        <p ng-if="vm.files.length != 0 && vm.agent.is_remote == false">Here is shown in table the list of all uploaded files of this agent.</p>
                        <p ng-if="vm.files.length == 0 && vm.agent.is_remote == false">This agent doesn't have any uploaded file.</p>

                        <table ng-if="vm.files.length != 0 && vm.agent.is_remote == false" class="table table-striped table-hover">
                            <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Size</th>
                                <th>Last Modification</th>
                                <th>Download</th>
                                <th>Remove File</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="(key,value) in vm.files">
                                <td><a href="/panel/{{vm.agent.team_name}}/{{vm.agent.agent_name}}/agentDetail/{{value.file}}/">{{value.file}}</a></td>
                                <td>{{value.size}}</td>
                                <td>{{value.last_modification}}</td>
                                <td><a class = "awe-download-alt" href="/api/v1/agents/file/{{vm.agent.team_name}}/{{vm.agent.agent_name}}/{{value.file}}/" target="_blank"></a></td>
                                <td><a ng-click="vm.deleteUpload(value.file)" class="btn btn-primary btn-flat">X</a></td>
                            </tr>
                            </tbody>

                        </table>
                        <div align="right">
                            <a ng-if="vm.files.length != 0" href="/api/v1/agents/agent_all_files/{{vm.agent.team_name}}/{{vm.agent.agent_name}}/" target="_blank">Download All</a>
                        </div>
                        <strong style="font-size: large">Files: </strong>
                        <br/>
                        <output id="list"></output>

                        <input id="fileupload"
                               type="file" name="files[]"
                               class="inputFile clickable"
                               multiple=""
                                />

                        <script>
                            function handleFileSelect(evt) {
                                var files = evt.target.files; // FileList object

                                // files is a FileList of File objects. List some properties.
                                var output = [];
                                for (var i = 0, f; f = files[i]; i++) {
                                    output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                                            f.size, ' bytes, last modified: ',
                                            f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                                            '</li>');
                                }
                                document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
                            }

                            document.getElementById('fileupload').addEventListener('change', handleFileSelect, false);
                        </script>
                        <br/>

                        <button class="btn btn-flat btn-success" ng-click="vm.uploadFile()">Upload All</button>
                        <br/>
                        <br/>
                        <span class="awe-exclamation-sign"></span><b>
                        <a data-toggle="modal"  href="#samples">See the Samples</a></b>
                        <br/>
                        <br/>
                        <div class="modal fade"  id="samples">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">Ã—</button>

                                <h2 align="center">Samples</h2>
                            </div>
                            <div class="modal-body">
                                <strong>You can download the sample files for your agent's language:</strong><br/>
                                <a href="/static/samples/{{vm.agent.language}}.zip"  target="_blank">- {{vm.agent.language}} Samples</a>
                            </div>
                            <div class="modal-footer">
                                Note that <strong>execute.sh</strong> file is required and <strong>prepare.sh</strong> is optional
                            </div>
                        </div>
                    </div>

                </section>
                <a href="javascript:history.go(-1)" class="btn btn-flat btn-large btn-primary">Back</a>


            </div>

        </article>
    </div>
</div>


